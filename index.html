<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>LED Arena Counter - Neon Glow</title>
<style>
html, body {
  margin:0; padding:0; width:100%; height:100%;
  background:black; overflow:hidden;
  font-family:'Arial Black',Arial,sans-serif;
  touch-action: manipulation; overscroll-behavior:none;
  user-select:none;
}
*{
  -webkit-touch-callout:none; -webkit-user-select:none;
  -moz-user-select:none; -ms-user-select:none; user-select:none;
}
#container{
  display:flex; flex-direction:column; justify-content:center; align-items:center;
  height:100%; padding-top:12vh;
}
#cockpit-name{
  position:fixed; top:10px; left:50%; transform:translateX(-50%);
  color:#00ffff; font-size:6vw; font-weight:bold; z-index:20;
}
.stage{
  position:relative; font-size:8vw; margin:1vh 0;
  width:80%; display:flex; justify-content:center; align-items:center;
}
.stage-text{ font-weight:bold; cursor:pointer; text-shadow:0 0 10px currentColor; transition:all .2s ease; }
.jump-zone{ position:absolute; inset:0; }
#ready{color:#00ff4c;}
#limber{color:#ffffff;}
#helling-area{color:#ff2a2a;}
.active{transform:scale(1.05);}
.pulse{animation:pulseGlow .7s infinite alternate;}
@keyframes pulseGlow{0%{text-shadow:0 0 20px currentColor;}50%{text-shadow:0 0 80px currentColor;}100%{text-shadow:0 0 20px currentColor;}}
.highlight-glow{animation:neonGlow .7s infinite alternate;}
@keyframes neonGlow{0%{text-shadow:0 0 10px currentColor;}50%{text-shadow:0 0 80px currentColor;}100%{text-shadow:0 0 10px currentColor;}}
#modal{position:fixed; inset:0; background:rgba(0,0,0,.7); display:flex; justify-content:center; align-items:center; opacity:0; pointer-events:none; transition:.3s;}
#modal.show{opacity:1; pointer-events:auto;}
#modal-content{background:#222; color:white; padding:20px; border-radius:10px; transform:scale(.7); transition:.3s;}
#modal.show #modal-content{transform:scale(1);}
#modal-content input{font-size:1.5rem; width:80px; text-align:center;}
#modal-content button{font-size:1rem; padding:5px 10px; margin-left:10px;}
#start-screen{
  position:fixed; inset:0; background:black; color:white;
  display:flex; justify-content:center; align-items:center; font-size:5vw;
  z-index:50; cursor:pointer; user-select:none; text-align:center;
}
</style>
</head>
<body>

<!-- START SCREEN -->
<div id="start-screen">TAP TO START</div>

<div id="container" style="display:none;">
  <div id="cockpit-name" contenteditable="true">ARENA 1</div>

  <div class="stage" id="ready">
    <div class="stage-text">READY <span class="number">1</span></div>
    <div class="jump-zone"></div>
  </div>

  <div class="stage" id="limber">
    <div class="stage-text">LIMBER <span class="number">1</span></div>
    <div class="jump-zone"></div>
  </div>

  <div class="stage" id="helling-area">
    <div class="stage-text">HELLING AREA <span class="number">1</span></div>
    <div class="jump-zone"></div>
  </div>
</div>

<!-- AUDIO -->
<audio id="beep" preload="auto">
  <source src="beep.mp3" type="audio/mpeg">
  <source src="https://assets.mixkit.co/active_storage/sfx/212/212-preview.mp3" type="audio/mpeg">
</audio>

<!-- MODAL -->
<div id="modal">
  <div id="modal-content">
    <div id="modal-title"></div>
    <input type="number" id="modal-input" min="1">
    <button id="modal-ok">Go</button>
  </div>
</div>

<script>
/* ===== DATA ===== */
let stages=["READY","LIMBER","HELLING AREA"];
let stageNumbers={READY:1,LIMBER:1,"HELLING AREA":1};
let stageIndex=0;
const REPEAT_COUNT=5, PAUSE_MS=1500;
let longPressTimer=null;

const stageEls={
  READY:document.getElementById("ready"),
  LIMBER:document.getElementById("limber"),
  "HELLING AREA":document.getElementById("helling-area")
};
const beep=document.getElementById("beep");
const modal=document.getElementById("modal");
const modalTitle=document.getElementById("modal-title");
const modalInput=document.getElementById("modal-input");
const modalOk=document.getElementById("modal-ok");
const cockpitEl=document.getElementById("cockpit-name");
const startScreen=document.getElementById("start-screen");
const container=document.getElementById("container");

/* ===== STORAGE ===== */
function loadState(){
  const s=localStorage.getItem("arenaState");
  if(s){const d=JSON.parse(s); stageNumbers=d.stageNumbers||stageNumbers; stageIndex=d.stageIndex||stageIndex;}
  const c=localStorage.getItem("cockpitName");
  if(c) cockpitEl.textContent=c;
}
function saveState(){
  localStorage.setItem("arenaState",JSON.stringify({stageNumbers,stageIndex}));
}
cockpitEl.addEventListener("input",()=>{localStorage.setItem("cockpitName",cockpitEl.textContent.trim());});

/* ===== DISPLAY ===== */
function updateDisplay(){
  Object.values(stageEls).forEach(el=>el.classList.remove("active","pulse"));
  const s=stages[stageIndex];
  stageEls[s].classList.add("active");
  stages.forEach(k=>{
    stageEls[k].querySelector(".stage-text").innerHTML=`${k} <span class="number">${stageNumbers[k]}</span>`;
  });
  saveState();
}

/* ===== SPEAK ===== */
function speak(text){
  return new Promise(res=>{
    if(!("speechSynthesis" in window)){res(); return;}
    const u=new SpeechSynthesisUtterance(text);
    const v=speechSynthesis.getVoices();
    if(v.length===0){res(); return;}
    u.voice=v.find(x=>x.lang.startsWith("en"))||v[0];
    u.onend=res; speechSynthesis.speak(u);
  });
}

/* ===== ANNOUNCE ===== */
async function announce(){
  const stage=stages[stageIndex], num=stageNumbers[stageIndex]||stageNumbers[stages[stageIndex]], text=`${stage} ${num}`;
  const textEl=stageEls[stage].querySelector(".stage-text");
  stageEls[stage].classList.add("pulse");
  for(let i=0;i<REPEAT_COUNT;i++){
    textEl.classList.add("highlight-glow");
    beep.currentTime=0; beep.play();
    await speak(text);
    textEl.classList.remove("highlight-glow");
    await new Promise(r=>setTimeout(r,PAUSE_MS));
  }
  stageEls[stage].classList.remove("pulse");
}

/* ===== MODAL ===== */
function showModal(name){modalTitle.textContent=`Jump ${name} to number:`; modalInput.value=stageNumbers[name]; modal.classList.add("show");}
function hideModal(){modal.classList.remove("show");}

/* ===== STAGE EVENTS ===== */
function setupStage(el,idx){
  let lastTap=0;
  const name=stages[idx];
  const textEl=el.querySelector(".stage-text");
  const zone=el.querySelector(".jump-zone");

  // Long press
  zone.addEventListener("pointerdown",()=>{
    longPressTimer=setTimeout(()=>{stageIndex=idx; showModal(name);},600);
  });
  zone.addEventListener("pointerup",()=>clearTimeout(longPressTimer));

  // Tap / double-tap
  textEl.addEventListener("click",()=>{
    const now=Date.now();
    stageIndex=idx;
    if(now-lastTap<300){stageNumbers[name]=Math.max(1,stageNumbers[name]-1); lastTap=0;}
    else{stageNumbers[name]++; lastTap=now;}
    updateDisplay(); announce();
  });
}

/* ===== MODAL BUTTON ===== */
modalOk.addEventListener("click",()=>{
  const n=parseInt(modalInput.value);
  if(n>0){ stageNumbers[stages[stageIndex]]=n; updateDisplay(); announce(); }
  hideModal();
});
modal.addEventListener("click",e=>{if(e.target===modal) hideModal();});

/* ===== RIGHT CLICK BLOCK ===== */
document.addEventListener("contextmenu",e=>e.preventDefault());
window.oncontextmenu=()=>false;

/* ===== START SCREEN FULLSCREEN ===== */
startScreen.addEventListener("click", ()=>{
  const el=document.documentElement;
  if(el.requestFullscreen) el.requestFullscreen();
  else if(el.webkitRequestFullscreen) el.webkitRequestFullscreen();

  startScreen.style.display="none";
  container.style.display="flex";

  // Preload audio & voices
  beep.load();
  if('speechSynthesis' in window) speechSynthesis.getVoices();

  // Setup stage events AFTER fullscreen + tiny delay
  setTimeout(()=>{
    Object.values(stageEls).forEach((el,i)=>setupStage(el,i));
    updateDisplay();
  },50);
});

/* ===== INIT ===== */
loadState();
updateDisplay();
</script>

</body>
</html>
